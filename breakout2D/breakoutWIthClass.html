<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Hello</title>
        <style>
            * { padding: 0; margin: 0; }
            canvas { background: #eee; display: block; margin: 0 auto; }
        </style>
    </head>
    <body>
    <canvas id="myCanvas" width="480" height="320"></canvas>
        <script>
            class Main{
                constructor(){
                    this.canvas = document.getElementById("myCanvas");
                    this.ctx = this.canvas.getContext("2d");  
                    var obj_Ball = new Ball( this.canvas.width/2 , this.canvas.height-30 , 2 , -2 ,10);
                    this.ball = obj_Ball ;
                    var obj_Paddle = new Paddle();
                    this.paddle = obj_Paddle;

                    this.brickRowCount = 5;
                    this.brickColumnCount = 3;
                    this.brickWidth = 75;
                    this.brickHeight = 20;
                    this.brickPadding = 10;
                    this.brickOffsetTop = 30;
                    this.brickOffsetLeft = 30;
                    

                    // Declare object wall
                    this.bricks = [];
                    for (var c = 0; c < this.brickColumnCount; c++) {
                      this.bricks[c] = [];
                      for (var r = 0; r < this.brickRowCount; r++) {
                        this.bricks[c][r] = new Wall(0,0,1);
                      }
                    }       
                }

                drawBricks() {
                  for (var c = 0; c < this.brickColumnCount; c++) {
                    for (var r = 0; r < this.brickRowCount; r++) {
                      if (this.bricks[c][r].status == 1) { //จะวาดกำแพงที่ยังไม่ถูกทำลาย
                        var brickX = (r * (this.brickWidth + this.brickPadding)) + this.brickOffsetLeft;
                        var brickY = (c * (this.brickHeight + this.brickPadding)) + this.brickOffsetTop;
                        this.bricks[c][r].x = brickX;
                        this.bricks[c][r].y = brickY;
                        this.ctx.beginPath();
                        this.ctx.rect(brickX, brickY, this.brickWidth, this.brickHeight);
                        this.ctx.fillStyle = "#0095DD";
                        this.ctx.fill();
                        this.ctx.closePath();
                      }
                    }
                  }
                }

                draw(){   
                    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);        
                    this.ball.drawBall() ;
                    this.ball.moveBall() ;
                    this.paddle.drawPaddle();
                    this.drawBricks();
                    //new function not complete
                    this.paddle.movePaddle() ;
                }
            }
            class Ball{
                constructor( x , y , dx , dy , ballRadius){
                    this.canvas = document.getElementById("myCanvas");
                    this.ctx = this.canvas.getContext("2d");  
                    this.x = x;
                    this.y = y;
                    this.dx = dx;
                    this.dy = dy;
                    this.ballRadius = ballRadius;
                }
                drawBall(){
                    this.ctx.beginPath();
                    this.ctx.arc(this.x, this.y, this.ballRadius, 0, Math.PI*2);
                    this.ctx.fillStyle = "#0095DD";
                    this.ctx.fill();
                    this.ctx.closePath();
                }
                moveBall(){
                    if(this.x + this.dx > this.canvas.width-this.ballRadius || this.x + this.dx < this.ballRadius) {
                        this.dx = -this.dx;
                    }
                    if(this.y + this.dy > this.canvas.height-this.ballRadius || this.y + this.dy < this.ballRadius) {
                        this.dy = -this.dy;
                    }
                    this.x += this.dx ;
                    this.y += this.dy ;
                }
            }
            class Wall{
                constructor( x , y , status){
                this.canvas = document.getElementById("myCanvas");
                this.ctx = this.canvas.getContext("2d");  
                  this.x = x;
                  this.y = y;
                  this.status = status;

                }
            }
            class Paddle{
                constructor(){
                    this. canvas = document.getElementById("myCanvas");
                    this. ctx = this.canvas.getContext("2d"); 
                    var paddleHeight = 10;
                    this.paddH = paddleHeight ;
                    var paddleWidth = 75;
                    this.paddW = paddleWidth ;
                    var paddleX = (this.canvas.width-paddleWidth)/2;
                    this.padX= paddleX ;
                    //not complete
                    var input= new InputProcessor();
                    this.ip = input;

                }
                 drawPaddle() {
                    this.ctx.beginPath();
                    this.ctx.rect(this.padX, this.canvas.height-this.paddH, this.paddW, this.paddH);
                    this.ctx.fillStyle = "#0095DD";
                    this.ctx.fill();
                    this.ctx.closePath();
                }
                //new funtion not complete
                movePaddle(){
                    document.addEventListener("keydown", this.ip.keyDownHandler , false);
                    document.addEventListener("keyup", this.ip.keyUpHandler, false);
                    //this.input.keyDownHandler();
                    //this.input.keyUpHandler();
                    console.log(this.ip.rPressed);
                    if(this.ip.rPressed === true) {
                        this.padX += 7;
                        if (this.padX + this.paddW > canvas.width){
                            this.padX = canvas.width - this.paddW;
                        }
                    }
                    else if(this.ip.lPressed === true) {
                        this.padX -= 7;
                        if (this.padX < 0){
                            this.padX = 0;
                        }
                    }
                }
            }
            // not complete
            class InputProcessor{
                constructor(){
                    //var rightPressed = false;
                    //this.rPressed = rightPressed;
                    this.rPressed = false ;
                    //var leftPressed = false;
                    //this.lPressed = leftPressed;
                    this.lPressed = false ;
                }
                
                keyDownHandler(e) {
                    console.log("down");
                    if(e.key == "Right" || e.key == "ArrowRight") {
                         this.rPressed  = true;
                    }
                    else if(e.key == "Left" || e.key == "ArrowLeft") {
                         this.lPressed = true;
                    }
                }
                keyUpHandler(e) {
                    console.log("up")
                    if(e.key == "Right" || e.key == "ArrowRight") {
                         this.rPressed  = false;
                    }
                    else if(e.key == "Left" || e.key == "ArrowLeft") {
                         this.lPressed = false;
                    }
                }
            }
            
            var game=  new Main(5);
            function Run(){
                game.draw();
            }
            setInterval(Run, 10); 
            
        </script>   
    </body>
</html>